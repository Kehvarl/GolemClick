<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <script src="https://unpkg.com/vue@next"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Two+Tone" rel="stylesheet">
    <title>GolemClick</title>
    <style>
      .entity{
        float:left;
        margin-left: 1em;
        margin-bottom: 1em;
      }
      .monsters{
        clear:both;
      }
    </style>
  </head>
  <body>
    <div id="clicker">
      <entity v-model:value="player" @clicked="player_click"></entity>

      <monsters v-model:monsters="entities" @clicked="monster_click"></monsters>
    </div>
  </body>
  <script type="text/javascript">

    function entity(type, atk, def, hp, magic, xp, xp_value){
      return {
        type: type,
        atk: atk,
        def: def,
        hp: hp,
        max_hp: hp,
        magic: magic,
        max_magic: magic,
        xp: xp,
        xp_value: xp_value
      };
    }

    const clicker = Vue.createApp({
      data(){
        return {
          player: entity("Player", 5, 5, 10, 10, 0, 0),
          entities: [
            entity("Kobold", 1, 3, 5, 0, 0, 6),
            entity("Goblin", 2, 2, 7, 0, 0, 7),
            entity("Human", 5, 5, 10, 0, 0, 8),
            entity("Orc", 6, 5, 12, 0, 0, 9),
            entity("Ogre", 7, 5, 15, 0, 0, 10)
          ]
        }
      },

      methods: {
        player_click() {
          this.player.hp = Math.min(this.player.hp + 1, this.player.max_hp);
        },
        combat(m){
          m_dmg = Math.max(this.player.atk - this.entities[m].def, 0);
          p_dmg = Math.max(this.entities[m].atk - this.player.def, 0);
          this.entities[m].hp -= m_dmg;
          this.player.hp -= p_dmg;
          if (this.entities[m].hp <= 0){
            this.player.xp += this.entities[m].xp_value;
          }

        },
        monster_click(index){
          if (this.entities[index].hp > 0){
            this.combat(index);
            this.entities = this.entities.filter(function(el) {
              return el.hp > 0;
            });
          }
        }
      }
    });

    clicker.component('monsters',{
      props: {monsters: Array},
      emits: ['clicked'],
      methods: {
        clicked(index){
            this.$emit('clicked', index);
        }
      },
      template:`
        <div class="monsters">
          <template v-for="(monster, index) in monsters">
            <entity v-model:value="monster" @clicked="clicked(index)"></entity>
          </template>
        </div>`
    });

    clicker.component('entity',{
      emits: ['clicked'],
      props: {value: Object, index: Number},
      methods: {
        click(){
          this.$emit('clicked');
        }
      },
      template: `
      <div class="entity" v-on:click="click">
        <div title="Type"><span class="material-icons-two-tone">accessibility</span> {{ value.type }} <span v-if="value.xp > 0">XP: {{ value.xp }}</span></div>
        <div v-if="value.atk > 0" title="Attack"><span class="material-icons-two-tone">gavel</span> {{ value.atk }}</div>
        <div v-if="value.def > 0" title="Defense"><span class="material-icons-two-tone">security</span> {{ value.def }}</div>
        <div title="HP"><span class="material-icons-two-tone">favorite</span> {{ value.hp }} / {{ value.max_hp }}</div>
        <div v-if="value.max_magic > 0" title="Magic"><span class="material-icons-two-tone">self_improvement</span> {{ value.magic }}/ {{value.max_magic}}</div>
      </div>`
    });

    clicker.mount('#clicker');
  </script>
</html>
